Задание 4.1
1 point possible (graded)
База данных содержит список аэропортов практически всех крупных городов России.
В большинстве городов есть только один аэропорт. Исключение составляет:
select 
    a.city,
    count(a.city)
from
    DST_PROJECT.airports a
group by
    a.city
having
    count(a.city) > 1

Задание 4.2
4 points possible (graded)

Вопрос 1. Таблица рейсов содержит всю информацию о прошлых, текущих и запланированных рейсах.
Сколько всего статусов для рейсов определено в таблице?
select 
    count(distinct f.status)
from
    dst_project.flights f

Вопрос 2. Какое количество самолетов находятся в воздухе на момент среза в базе
(статус рейса «самолёт уже вылетел и находится в воздухе»).

select 
    count(f.status)
from
    dst_project.flights f
where
    f.status = 'Departed'

Вопрос 3. Места определяют схему салона каждой модели. Сколько мест имеет самолет модели  (Boeing 777-300)?

select
    count(s.seat_no)
from
    dst_project.seats s
where
    s.aircraft_code = '773' --aircraft code

Вопрос 4. Сколько состоявшихся (фактических) рейсов было совершено между 1 апреля 2017 года и 1 сентября 2017 года?

select
    count(f.status)
from
    dst_project.flights f
where
    (f.actual_arrival between '2017-04-01' and '2017-09-01')
    and (f.status = 'Arrived')

Вопрос 4. У какого рейса была самая большая задержка прибытия за все время сбора данных? Введите id рейса (flight_id).

select
    f.flight_id
from
    dst_project.flights f
where
    f.actual_departure is not null
group by
    f.flight_id
order by
    f.actual_departure - f.scheduled_departure desc
limit 1

Задание 4.4
4 points possible (graded)
Вопрос 1. Когда был запланирован самый первый вылет, сохраненный в базе данных?

select
    f.flight_id
from
    dst_project.flights f
where
    f.actual_departure is not null
group by
    f.flight_id
order by
    f.actual_departure - f.scheduled_departure desc
limit 1

Вопрос 2. Сколько минут составляет запланированное время полета в самом длительном рейсе?

select
    f.scheduled_arrival - f.scheduled_departure 
from
    dst_project.flights f
order by
    1 desc
limit 1

Вопрос 3. Между какими аэропортами пролегает самый длительный по времени запланированный рейс?

select
    f.departure_airport, arrival_airport
from
    dst_project.flights f
order by
    f.scheduled_arrival - f.scheduled_departure desc
limit 1

Вопрос 4. Сколько составляет средняя дальность полета среди всех самолетов в минутах?
Секунды округляются в меньшую сторону (отбрасываются до минут).

select
    (extract(hour from avg(f.scheduled_arrival - f.scheduled_departure))*60)+
    (extract(minutes from avg(f.scheduled_arrival - f.scheduled_departure)))+
    ((extract(seconds from avg(f.scheduled_arrival - f.scheduled_departure)))/60)
from
    dst_project.flights f

Задание 4.5
3 points possible (graded)
Вопрос 1. Мест какого класса у SU9 больше всего?

select
    'Business', count(s.fare_conditions)
from
    dst_project.seats s
where
    s.aircraft_code = 'SU9' and s.fare_conditions = 'Business'
union
select
    'Economy', count(s.fare_conditions)
from
    dst_project.seats s
where
    s.aircraft_code = 'SU9' and s.fare_conditions = 'Economy'
union
select
    'Standart', count(s.fare_conditions)
from
    dst_project.seats s
where
    s.aircraft_code = 'SU9' and s.fare_conditions = 'Standart'
union
select
    'Comfort', count(s.fare_conditions)
from
    dst_project.seats s
where
    s.aircraft_code = 'SU9' and s.fare_conditions = 'Comfort'
order by 2 desc

Вопрос 2. Какую самую минимальную стоимость составило бронирование за всю историю?

select
    min(b.total_amount)
from
    dst_project.bookings b

Вопрос 3. Какой номер места был у пассажира с id = 4313 788533?

select
    b.seat_no
from
    dst_project.tickets t
        join dst_project.boarding_passes b on t.ticket_no = b.ticket_no
where
    passenger_id = '4313 788533'

Задание 5.1
5 points possible (graded)
Вопрос 1. Анапа — курортный город на юге России. Сколько рейсов прибыло в Анапу за 2017 год?

-- AAQ Anapa airport code
select
    count(f.status)
from
    dst_project.flights f
where
    f.arrival_airport = 'AAQ' 
    and f.actual_arrival between '2017-01-01' and '2017-12-31'

Вопрос 2. Сколько рейсов из Анапы вылетело зимой 2017 года?

select
    count(f.status)
from
    dst_project.flights f
where departure_airport = 'AAQ'
  and (date_trunc('month', actual_departure) in ('2017-01-01','2017-02-01', '2017-12-01'))
  and status not in ('Cancelled')

Вопрос 3. Посчитайте количество отмененных рейсов из Анапы за все время.

select
    count(f.status)
from
    dst_project.flights f
where
    f.departure_airport = 'AAQ' and f.status = 'Cancelled'

Вопрос 4. Сколько рейсов из Анапы не летают в Москву?

select
    count(distinct f.flight_id)
from 
    dst_project.flights f
where
    arrival_airport not in ('DME', 'SVO', 'VKO')
    and departure_airport = 'AAQ'

Вопрос 5. Какая модель самолета летящего на рейсах из Анапы имеет больше всего мест?

select
    count(s.seat_no),
    s.aircraft_code
from
    dst_project.seats s
where
    aircraft_code in ('733', 'SU9') -- Boeing 737-300 (733)  Sukhoi Superjet-100 (SU9)
group by
    s.aircraft_code

